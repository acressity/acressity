{% extends "narratives/base.html" %}

{% load comments %}

{% block content %}
	<div class="narrative_detail">
		<h2>{{ narrative.title }}</h2>
		<p>from experience <a href="{% url 'experience' narrative.experience.id %}">{{ narrative.experience }}</p>
		<div class="option_list">
			<a href="{% url 'experiences.views.index' narrative.experience.id %}"><img src="{{ STATIC_URL }}img/icons/back-icon.png" title="Back to the experience page" class="option_icon" /></a>
			{% if narrative.gallery %}
				<a href="{% url 'pl-gallery' narrative.gallery.id %}"><img src="{{ STATIC_URL }}img/icons/gallery-icon.png" class="option_icon" title="View Photos for {{ narrative }}" /></a>
			{% endif %}
			{% if author %}
				<a href="{% url 'narratives.views.edit' narrative.id %}"><img src="{{ STATIC_URL }}img/icons/edit-icon.png" title="Edit this narrative" class="option_icon" /></a>
				<a href="/narratives/{{ narrative.id }}/upload_photo/"><img src="{{ STATIC_URL }}img/icons/image-upload-icon.png" title="Upload a photo" class="option_icon" /></a>
				<a href="{% url 'narratives.views.delete' narrative.id %}"><img src="{{ STATIC_URL }}img/icons/delete-icon.png" title="Delete this narrative" class="option_icon" /></a>
			{% endif %}
		</div>
		{% if narrative.gallery.photos %}
			<div class="images_right">
				{% for photo in narrative.gallery.photos.all %}
					<div class="narrative_photo">
						<a href="{{ photo.get_absolute_url }}"><img src="{{ photo.get_thumbnail_url }}" title="{{ photo.title }}" /></a>
						{% if photo.caption %}
							<div class="photo_caption">
								{{ photo.caption }}
							</div>
						{% endif %}
					</div>
				{% endfor %}
			</div>
		{% endif %}
		<p>{{ narrative.date_created }}</p>
		{% if narrative.parse_for_embed %}
			<p>{{ narrative.parse_for_embed|safe }}</p>
		{% endif %}
		<p>
			{{ narrative.narrative|escape|linebreaks }}
		</p>
		<div class="clear_both"> </div>
	</div>
	<div class="next_previous">
		{% if narrative.get_previous_narrative %}
			<a href="{% url 'narratives.views.index' narrative.get_previous_narrative.id %}" title="{{ narrative.get_previous_narrative }}"><img src="{{ STATIC_URL }}img/icons/previous-icon.png" class="float_right" title="Previous narrative" /></a>
		{% endif %}
		{% if narrative.get_next_narrative %}
			<a href="{% url 'narratives.views.index' narrative.get_next_narrative.id %}" title="{{ narrative.get_next_narrative }}"><img src="{{ STATIC_URL }}img/icons/next-icon.png" class="float_left" title="Next narrative" /></a>
		{% endif %}
	</div>
	{% get_comment_count for narrative as narr_comment_count %}
	{% if narr_comment_count > 0 %}
		<h4 title="Click to see comments" onclick="toggle_div('narr_comment_list');">{{ narr_comment_count }} note{{ narr_comment_count|pluralize }} <img src="{{ STATIC_URL }}img/icons/expand-icon.png" id="narr_comment_list_toggle_icon" /></h4>
		<div class="comment_list" id="narr_comment_list" style="display: none;">
			{% get_comment_list for narrative as narr_comment_list %}
			{% for note in narr_comment_list reversed %}
				{% include "support/comment_snippet.html" %}
			{% endfor %}
		</div>
	{% endif %}
	{% if user.is_authenticated %}
		{% get_comment_form for narrative as narr_comment_form %}
		<div class="comment">
			<form action="{% comment_form_target %}" method="POST">
				{% csrf_token %}
				{{ narr_comment_form.comment }}
				{{ narr_comment_form.honeypot }}
				{{ narr_comment_form.object_pk }}
				{{ narr_comment_form.content_type }}
			    {{ narr_comment_form.timestamp }}
			    {{ narr_comment_form.security_hash }}
				<br />
				<input type="hidden" name="next" value="{% url 'narratives.views.index' narrative.id %}">
				<input type="submit" value="Submit Note" />
			</form>
		</div>
	{% endif %}
{% endblock content %}
