{% extends "explorers/base.html" %}

{% load explorers_extras %}

{% block head_insert %}
	<script type="text/javascript">
		$(document).ready(function(){
			var options = {
				resetForm: true,
				error: errorHandler,
				dataType: 'json',
				success: addExperience,
			};

			$('#create_experience').submit(function(){
				$(this).ajaxSubmit(options);
				return false;
			});

			function addExperience(r){
				$("#experiences_list").append(r.html);
			}

			function errorHandler(jqXHR, textStatus, errorThrown){
				alert("There was a problem submitting the experience");
			}
		})
	</script>
{% endblock head_insert %}

{% block content %}
	
	{% comment %}
	<div class="explorer_item">
		<h1>{{ explorer.get_full_name|possessive }} Journey</h1>
		{% if explorer.gallery.featured_photo %}
			<div>
				<a href="{% url 'pl-gallery' explorer.gallery.id %}">
					<img src="{{ explorer.gallery.featured_photo.get_thumbnail_url }}" title="{{ explorer.get_full_name }}" />
				</a>
			</div>
		{% endif %}
		<h3 title="Trailname">Trailname: {{ explorer.trailname }}</h3>
		<div class="option_list">
			<a href="{% url 'story' explorer.id %}"><img src="{{ STATIC_URL }}img/icons/profile-icon.png" title="{{ explorer.first_name|possessive }} Story" class="option_icon" /></a>
			<a href="{% url 'board' explorer.id %}"><img src="{{ STATIC_URL }}img/icons/bulletin-board-icon.png" title="Check out the Bulletin Board" class="option_icon" /></a>
			
		</div>
	</div>
	{% endcomment %}

	{% ifnotequal user explorer %}
		{% include "explorers/snippets/dash.html" %}
	{% else %}
		<h1 style="text-align: center;">Your Journey</h1>
	{% endifnotequal %}
	<div id="experiences_list">
		{% for experience in experiences %}
			{% if forloop.first %}
				{% ifequal experience explorer.featured_experience %}
					<h2>Featured Experience</h2>
				{% else %}
					<h2>Experiences</h2>
				{% endifequal %}
			{% endif %}
			{% include "experiences/snippets/dash.html" %}
			{% if forloop.first %}
				{% if not forloop.last %}
					{% ifequal experience explorer.featured_experience %}
						<h2>Shelved Experiences</h2>
					{% endifequal %}
				{% endif %}
			{% endif %}
			{% if not forloop.last %}
				<hr />
			{% endif %}
		{% empty %}
			{% ifnotequal user explorer %}
				{{ explorer }} doesn't currently have any public experiences
			{% else %}
				<div class="post_it">
					<p>
				        It's good to have you here! This application is designed to help you explore new experiences, with each experience being an item in your bucketlist.
				    </p>
				    <h3>Begin by</h3>
				    <ul>
				    	<li>Creating a list of experiences you wish to have</li>
				    	<li>Featuring one experience upon which you're currently focusing</li>
				    	<li>Writing narratives to record your progress for each experience</li>
				    	<li><a href="/photologue/gallery/{{ explorer.gallery.id }}/upload_photo/">Uploading</a> a photo to be displayed beside your journey</li>
				    </ul>
				</div>
			{% endifnotequal %}
		{% endfor %}
	</div>
	{% ifequal user explorer %}
		<div class="experience_item">
			<h2 class="toggler" onclick="toggle_div('create_experience_div');">{% if experiences %}Add another experience to your journey{% else %}Create a new experience{% endif %} <img src="{{ STATIC_URL }}img/icons/expand-icon.png" id="create_experience_div_toggle_icon" /></h2>
			<div id="create_experience_div" class="toggle_div">
				<form action="{% url 'create_experience' %}" id="create_experience" class="full_width" method="POST">
					{% csrf_token %}
					<div class="formatted_input">
						{{ form.experience }}
					</div>
					<h4 class="toggler" onclick="toggle_div('more_options');">
						More options <img src="{{ STATIC_URL }}img/icons/expand-icon.png" id="more_options_toggle_icon" />
					</h4>
					<div class="toggle_div" id="more_options">
						<div class="formatted_input">
							Experience is public {{ form.is_public }}
						</div>
						<div class="formatted_input">
							Feature this experience {{ form.make_feature }}
						</div>
					</div>
					<input type="hidden" id="ajax" name="ajax" value="True" /> {# used for the create_experience view #}
					<input type="submit" value="Create" />
				</form>
			</div>
		</div>
	{% endifequal %}
{% endblock content %}
