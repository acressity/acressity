{% extends "photologue/root.html" %}

{% block content %}
	<script type="text/javascript">
		$(document).ready(function(){
			var options = {
	            //target:   '#photo_form_feedback',   // target element(s) to be updated with server response
	            // beforeSubmit:  beforeSubmit,  // pre-submit callback
	            resetForm: true,        // reset the form after successful submit
	            error: what,
	            dataType: 'json',
	            success: show_photo,
		    };
		       
		    $('#photo_form').submit(function() {
		    		$("#ajax-loader").toggle();
		            $(this).ajaxSubmit(options);
		            // return false to prevent standard browser submit and page navigation
		            return false;
        	});

        	function show_photo(r){
        		$("#ajax-loader").toggle();
        		var html ="<div class=\"uploaded_photo\">";
        		html += "<a href=\"/photologue/photo/" + r.photo_id + "\">";
        		html += "<img src=\"" + r.url + "\" />";
        		html += "</a>";
        		html += "</div>";
        		$("#photo_form_feedback").append(html);
        	}

        	function what(a, b, c){
        		alert('error');
        		$("#ajax-loader").toggle();
        	}
		})
	</script>
	<h2>Upload photo for {{ gallery.title }}</h2>
	<div class="option_list">
		<a href="{% url 'pl-gallery' gallery.id %}"><img src="{{ STATIC_URL }}img/icons/back-icon.png" title="Back to gallery" class="option_icon" /></a>
		<a href="{% url 'pl-gallery-edit' gallery.id %}"><img class="option_icon" title="Edit this gallery" src="{{ STATIC_URL }}img/icons/edit-gallery-icon.png"></a>
	</div>
	<div style="position:relative;">
		<form action="{% url 'ajax_upload' %}" method="POST" id="photo_form" enctype="multipart/form-data">
			{% csrf_token %}
			<div class="formatted_input">
				<label for="id_image">
					<h3>Select image</h3>
				</label>
				{{ form.image.errors }}
				{{ form.image }}
			</div>
			<div class="formatted_input">
				<label for="id_title">
					<h3>Title</h3>
				</label>
				{{ form.title.errors }}
				{{ form.title }}
			</div>
			<div class="formatted_input">
				<label for="id_caption">
					<h3>Caption</h3>
				</label>
				{{ form.caption.errors }}
				{{ form.caption }}
			</div>
			<div class="formatted_input">
				<label for="id_feature">
					<h3>Make this photo the album feature? <input type="checkbox" {% if gallery.photos.count < 1 %}checked="checked"{% endif %} name="feature" id="id_feature" /></h3>
				</label>
				<h4 onclick="toggle_div('about_featured_photo');">About this <img src="{{ STATIC_URL }}img/icons/expand-icon.png" id="about_featured_photo_toggle_icon" /></h4>
				<div id="about_featured_photo" class="smaller_font" style="display: none;">
					The featured photo is used to represent the gallery and is displayed first in the gallery.
				</div>
			</div>
			<input type="hidden" name="gallery_id" id="id_gallery_id" value="{{ gallery.id }}" />
			<input type="submit" value="Upload" />
		</form>
		<div id="photo_form_feedback">
			<img src="{{ STATIC_URL }}img/gifs/ajax-loader.gif" id="ajax-loader" style="display:none;" />
		</div>
	</div>
{% endblock content %}